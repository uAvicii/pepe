import{_ as de}from"./CpIcon-7a643fa6.js";import{h as pe,i as _e}from"./consult-289bd216.js";import{d as j,r as T,e as w,f as C,k as W,w as u,i,t as N,h as t,l as v,S as ve,c as q,g as P,Z as me,_ as fe,$ as ye,j as p,P as ae,a0 as he,v as le,a as ge,u as Ce,N as be,J as M,s as oe,p as we,q as ke}from"./index-2d73d3b2.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as $e}from"./CpNavBar-7e03a693.js";import{_ as xe}from"./avatar-doctor-a9322c0f.js";import{I as U,O as D}from"./index-e2c7d3ed.js";import{u as Ie,b as Pe,a as Se}from"./index-0d06e4f1.js";import"./request-c57294e0.js";import"./order-98aac658.js";const De={class:"pay-type"},Te={class:"amount"},Me={class:"btn"},Oe=j({__name:"CpPaySheet",props:{orderId:{},actualPayment:{},show:{type:Boolean},payCallback:{default:"http://localhost:3000/room"}},setup(n){const o=T(!1),a=T(1),_=async()=>{ve("跳转支付");const c=await pe({orderId:n.orderId,paymentMethod:a.value,payCallback:n.payCallback});window.location.href=c.data.data.payUrl};return(c,l)=>{const r=de,d=w("van-checkbox"),m=w("van-cell"),y=w("van-cell-group"),h=w("van-button"),k=w("van-action-sheet");return C(),W(k,{show:o.value,"onUpdate:show":l[2]||(l[2]=b=>o.value=b),title:"选择支付方式",closeable:!1,"close-on-popstate":!1},{default:u(()=>[i("div",De,[i("p",Te,"￥"+N(c.actualPayment.toFixed(2))+"元",1),t(y,null,{default:u(()=>[t(m,{title:"微信支付",onClick:l[0]||(l[0]=b=>a.value=0)},{icon:u(()=>[t(r,{name:"consult-wechat"})]),extra:u(()=>[t(d,{checked:a.value===0},null,8,["checked"])]),_:1}),t(m,{title:"支付宝支付",onClick:l[1]||(l[1]=b=>a.value=1)},{icon:u(()=>[t(r,{name:"consult-alipay"})]),extra:u(()=>[t(d,{checked:a.value===1},null,8,["checked"])]),_:1})]),_:1}),i("div",Me,[t(h,{type:"primary",round:"",block:"",onClick:_},{default:u(()=>[v("立即支付")]),_:1})])])]),_:1},8,["show"])}}});const Ae=z(Oe,[["__scopeId","data-v-66fc5de2"]]),Ne={class:"cp-consult-more"},Be=j({__name:"CpConsultMore",props:{disabled:{type:Boolean}},emits:["on-del","on-preview"],setup(n,{emit:o}){const a=n,_=q(()=>[{text:"查看处方",disabled:a.disabled},{text:"删除订单"}]),c=(l,r)=>{r===0&&o("on-preview"),r===1&&o("on-del")};return(l,r)=>{const d=w("van-popover");return C(),P("div",Ne,[t(d,{placement:"top-start",actions:_.value,onSelect:c},{reference:u(()=>[v(" 更多 ")]),_:1},8,["actions"])])}}});const Ee=z(Be,[["__scopeId","data-v-7cd01438"]]);function se(n){return fe()?(ye(n),!0):!1}function R(n){return typeof n=="function"?n():p(n)}const H=typeof window<"u",Ve=()=>{};function Fe(n,o,a={}){const{immediate:_=!0}=a,c=T(!1);let l=null;function r(){l&&(clearTimeout(l),l=null)}function d(){c.value=!1,r()}function m(...y){r(),c.value=!0,l=setTimeout(()=>{c.value=!1,l=null,n(...y)},R(o))}return _&&(c.value=!0,H&&m()),se(d),{isPending:me(c),start:m,stop:d}}function Le(n){var o;const a=R(n);return(o=a==null?void 0:a.$el)!=null?o:a}const Ue=H?window:void 0,We=H?window.navigator:void 0;function Re(...n){let o,a,_,c;if(typeof n[0]=="string"||Array.isArray(n[0])?([a,_,c]=n,o=Ue):[o,a,_,c]=n,!o)return Ve;Array.isArray(a)||(a=[a]),Array.isArray(_)||(_=[_]);const l=[],r=()=>{l.forEach(h=>h()),l.length=0},d=(h,k,b,S)=>(h.addEventListener(k,b,S),()=>h.removeEventListener(k,b,S)),m=ae(()=>[Le(o),R(c)],([h,k])=>{r(),h&&l.push(...a.flatMap(b=>_.map(S=>d(h,b,S,k))))},{immediate:!0,flush:"post"}),y=()=>{m(),r()};return se(y),y}function je(){const n=T(!1);return he()&&le(()=>{n.value=!0}),n}function qe(n){const o=je();return q(()=>(o.value,!!n()))}function ze(n={}){const{navigator:o=We,read:a=!1,source:_,copiedDuring:c=1500,legacy:l=!1}=n,r=qe(()=>o&&"clipboard"in o),d=q(()=>r.value||l),m=T(""),y=T(!1),h=Fe(()=>y.value=!1,c);function k(){r.value?o.clipboard.readText().then(f=>{m.value=f}):m.value=L()}d.value&&a&&Re(["copy","cut"],k);async function b(f=R(_)){d.value&&f!=null&&(r.value?await o.clipboard.writeText(f):S(f),m.value=f,y.value=!0,h.start())}function S(f){const $=document.createElement("textarea");$.value=f??"",$.style.position="absolute",$.style.opacity="0",document.body.appendChild($),$.select(),document.execCommand("copy"),$.remove()}function L(){var f,$,e;return(e=($=(f=document==null?void 0:document.getSelection)==null?void 0:f.call(document))==null?void 0:$.toString())!=null?e:""}return{isSupported:d,text:m,copied:y,copy:b}}const F=n=>(we("data-v-18d6dd51"),n=n(),ke(),n),He={key:0,class:"consult-detail-page"},Je={class:"detail-head"},Ye={class:"text"},Ze=F(()=>i("p",{class:"tip"},"服务医生信息",-1)),Ge={class:"card"},Ke=F(()=>i("img",{class:"avatar",src:xe,alt:""},null,-1)),Qe={class:"doc"},Xe=F(()=>i("span",null,"极速问诊",-1)),et={class:"detail-patient"},tt={class:"detail-order"},nt=F(()=>i("h3",null,"订单信息",-1)),ot={key:0,class:"detail-time"},at={key:1,class:"detail-action van-hairline--top"},lt={class:"price"},st=F(()=>i("span",null,"需付款",-1)),ut={key:2,class:"detail-action van-hairline--top"},it={key:3,class:"detail-action van-hairline--top"},ct={key:4,class:"detail-action van-hairline--top"},rt={key:5,class:"detail-action van-hairline--top"},dt={key:1,class:"consult-detail-page"},pt=j({__name:"ConsultDetail",setup(n){const o=ge(),a=Ce(),_=[{label:"一周内",value:U.Week},{label:"一月内",value:U.Month},{label:"半年内",value:U.HalfYear},{label:"大于半年",value:U.More}],c=O=>{const s=_.find(A=>A.value===O);return s==null?void 0:s.label},l=[{label:"就诊过",value:0},{label:"没就诊过",value:1}],r=O=>{const s=l.find(A=>A.value===O);return s==null?void 0:s.label},d=T(!1),{loading:m,onCancel:y}=Ie(),{loadings:h,onDel:k}=Pe(()=>{a.push("/consult")}),{showPrescription:b}=Se(),{copy:S,copied:L,isSupported:f}=ze(),$=()=>{if(!f.value)return oe("未授权，不支持");S(e.value.orderNo)};ae(L,()=>{L.value&&oe("已复制")});const e=T();return le(async()=>{const O=await _e(o.params.id);e.value=O.data.data}),(O,s)=>{var Z,G,K,Q,X,ee;const A=$e,ue=w("van-icon"),I=w("van-cell"),J=w("van-cell-group"),ie=w("van-count-down"),x=w("van-button"),ce=Ee,re=Ae,Y=w("van-skeleton");return e.value?(C(),P("div",He,[t(A,{title:"问诊详情"}),i("div",Je,[i("div",Ye,[i("h3",null,"图文问诊 "+N((Z=e.value)==null?void 0:Z.payment)+" 元",1),i("span",{class:be(["sta green",{orange:((G=e.value)==null?void 0:G.status)===p(D).ConsultPay,green:((K=e.value)==null?void 0:K.status)===p(D).ConsultChat}])},N((Q=e.value)==null?void 0:Q.statusValue),3),Ze]),i("div",Ge,[Ke,i("p",Qe,[Xe,i("span",null,N((ee=(X=e.value)==null?void 0:X.docInfo)==null?void 0:ee.name),1)]),t(ue,{name:"arrow"})])]),i("div",et,[t(J,{border:!1},{default:u(()=>{var g,B,E,V;return[t(I,{title:"患者信息",value:`${(g=e.value)==null?void 0:g.patientInfo.name} | ${(B=e.value)==null?void 0:B.patientInfo.genderValue} | ${(E=e.value)==null?void 0:E.patientInfo.age}岁`},null,8,["value"]),t(I,{title:"患病时长",value:c(e.value.illnessTime)},null,8,["value"]),t(I,{title:"就诊情况",value:r(e.value.consultFlag)},null,8,["value"]),t(I,{title:"病情描述",label:(V=e.value)==null?void 0:V.illnessDesc},null,8,["label"])]}),_:1})]),i("div",tt,[nt,t(J,{border:!1},{default:u(()=>{var g,B,E,V,te;return[t(I,{title:"订单编号"},{value:u(()=>{var ne;return[i("span",{class:"copy",onClick:$},"复制"),v(" "+N((ne=e.value)==null?void 0:ne.orderNo),1)]}),_:1}),t(I,{title:"创建时间",value:(g=e.value)==null?void 0:g.createTime},null,8,["value"]),t(I,{title:"应付款",value:`￥${(B=e.value)==null?void 0:B.payment}`},null,8,["value"]),t(I,{title:"优惠券",value:`-￥${(E=e.value)==null?void 0:E.couponDeduction}`},null,8,["value"]),t(I,{title:"积分抵扣",value:`-￥${(V=e.value)==null?void 0:V.pointDeduction}`},null,8,["value"]),t(I,{title:"实付款",value:`￥${(te=e.value)==null?void 0:te.payment}`,class:"price"},null,8,["value"])]}),_:1})]),e.value.status===p(D).ConsultPay?(C(),P("div",ot,[v(" 请在 "),t(ie,{time:e.value.countdown*1e3},null,8,["time"]),v(" 内完成支付，超时订单将取消 ")])):M("",!0),e.value.status===p(D).ConsultPay?(C(),P("div",at,[i("div",lt,[st,i("span",null,"￥ "+N(e.value.payment),1)]),t(x,{type:"default",round:"",loading:p(m),onClick:s[0]||(s[0]=g=>p(y)(e.value))},{default:u(()=>[v(" 取消问诊 ")]),_:1},8,["loading"]),t(x,{type:"primary",round:"",onClick:s[1]||(s[1]=g=>d.value=!0)},{default:u(()=>[v("继续支付")]),_:1})])):M("",!0),e.value.status===p(D).ConsultWait?(C(),P("div",ut,[t(x,{type:"default",round:"",loading:p(m),onClick:s[2]||(s[2]=g=>p(y)(e.value))},{default:u(()=>[v(" 取消问诊 ")]),_:1},8,["loading"]),t(x,{type:"primary",round:"",to:"`/room?orderId=${detail.id}`"},{default:u(()=>[v("继续沟通")]),_:1})])):M("",!0),e.value.status===p(D).ConsultChat?(C(),P("div",it,[e.value.prescriptionId?(C(),W(x,{key:0,type:"default",round:""},{default:u(()=>[v("查看处方")]),_:1})):M("",!0),t(x,{type:"primary",round:"",to:"`/room?orderId=${detail.id}`"},{default:u(()=>[v("继续沟通")]),_:1})])):M("",!0),e.value.status===p(D).ConsultComplete?(C(),P("div",ct,[t(ce,{disabled:!e.value.prescriptionId,onOnDel:s[3]||(s[3]=g=>p(k)(e.value)),onOnPreview:s[4]||(s[4]=g=>p(b)(e.value.prescriptionId))},null,8,["disabled"]),t(x,{type:"default",round:"",to:"`/room?orderId=${detail.id}`"},{default:u(()=>[v("问诊记录")]),_:1}),e.value.evaluateId?(C(),W(x,{key:0,type:"primary",round:""},{default:u(()=>[v("写评价")]),_:1})):(C(),W(x,{key:1,type:"default",round:""},{default:u(()=>[v("查看评价")]),_:1}))])):M("",!0),e.value.status===p(D).ConsultCancel?(C(),P("div",rt,[t(x,{type:"default",round:"",loading:p(h),onClick:s[5]||(s[5]=g=>p(k)(e.value))},{default:u(()=>[v(" 删除订单 ")]),_:1},8,["loading"]),t(x,{type:"primary",round:"",to:"/"},{default:u(()=>[v("咨询其他医生")]),_:1})])):M("",!0),t(re,{payCallback:"",show:d.value,"onUpdate:show":s[6]||(s[6]=g=>d.value=g),"order-id":e.value.id,actualPayment:e.value.actualPayment},null,8,["show","order-id","actualPayment"])])):(C(),P("div",dt,[t(A,{title:"问诊详情"}),t(Y,{title:"",row:6,style:{"margin-top":"30px"}}),t(Y,{title:"",row:6,style:{"margin-top":"30px"}})]))}}});const kt=z(pt,[["__scopeId","data-v-18d6dd51"]]);export{kt as default};
