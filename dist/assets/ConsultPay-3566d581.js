import{_ as U}from"./CpIcon-c12cdf85.js";import{_ as M}from"./CpNavBar-f66575fb.js";import{_ as N}from"./avatar-doctor-a9322c0f.js";import{c as R,e as A,f as L,h as j}from"./consult-41ff88f5.js";import{d as q,D as E,u as F,r as u,R as z,v as G,e as p,f as H,g as J,h as e,i as t,t as k,w as o,j as K,l as x,s as P,S as Q,p as W,q as X}from"./index-5649a6a1.js";import{a as Y}from"./function-call-91412ede.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-4d5e4c58.js";const v=_=>(W("data-v-53e9aa0f"),_=_(),X(),_),ee={class:"consult-pay-page"},te={class:"pay-info"},ae={class:"tit"},oe=v(()=>t("img",{class:"img",src:N},null,-1)),ne=v(()=>t("p",{class:"desc"},[t("span",null,"极速问诊"),t("span",null,"自动分配医生")],-1)),se=v(()=>t("div",{class:"pay-space"},null,-1)),le={class:"pay-schema"},ce=v(()=>t("span",{class:"text"},"支付协议",-1)),ue={class:"pay-type"},ie={class:"amount"},pe={class:"btn"},re=q({__name:"ConsultPay",setup(_){const a=E(),I=F(),l=u({}),C=async()=>{const n=await R({type:a.consult.type,illnessType:a.consult.illnessType});l.value=n.data.data},d=u({}),$=async()=>{if(!a.consult.patientId)return;const n=await A(a.consult.patientId);d.value=n.data.data},m=u(!1),f=u(!1),i=u(1),y=u(!1),h=u(""),D=async()=>{if(!m.value)return P("请勾选我已同意支付协议");y.value=!0;const n=await L(a.consult);h.value=n.data.data.id,y.value=!1,f.value=!0},S=async()=>{if(i.value===void 0)return P("请选择支付方式");Q("跳转支付");const n=await j({orderId:h.value,paymentMethod:i.value,payCallback:"http://localhost:3000/room"});window.location.href=n.data.data.payUrl};return z(()=>{if(h.value)return!1}),G(()=>{if(!a.consult.type||!a.consult.illnessType||!a.consult.depId||!a.consult.patientId)return Y({title:"温馨提示",message:"问诊信息不完整请重新填写，如有未支付的问诊订单可在问诊记录中继续支付",closeOnPopstate:!1}).then(()=>{I.push("/")});C(),$()}),(n,s)=>{const V=M,c=p("van-cell"),g=p("van-cell-group"),b=p("van-checkbox"),T=p("van-submit-bar"),w=U,B=p("van-button"),O=p("van-action-sheet");return H(),J("div",ee,[e(V,{title:"支付"}),t("div",te,[t("p",ae,"图文问诊 "+k(l.value.payment)+" 元",1),oe,ne]),e(g,null,{default:o(()=>[e(c,{title:"优惠券",value:`-¥${l.value.couponDeduction}`},null,8,["value"]),e(c,{title:"积分抵扣",value:`-¥${l.value.pointDeduction}`},null,8,["value"]),e(c,{title:"实付款",value:`-¥${l.value.actualPayment}`,class:"pay-price"},null,8,["value"])]),_:1}),se,e(g,null,{default:o(()=>[e(c,{title:"患者信息",value:`${d.value.name} | ${d.value.genderValue} | ${d.value.age}岁`},null,8,["value"]),e(c,{title:"病情描述",label:K(a).consult.illnessDesc},null,8,["label"])]),_:1}),t("div",le,[e(b,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=r=>m.value=r)},{default:o(()=>[x("我已同意 "),ce]),_:1},8,["modelValue"])]),e(T,{"button-type":"primary",price:l.value.actualPayment*100,"button-text":"立即支付","text-align":"left",loading:y.value,onClick:D},null,8,["price","loading"]),e(O,{show:f.value,"onUpdate:show":s[3]||(s[3]=r=>f.value=r),"close-on-popstate":!1,closeable:!1,title:"选择支付方式"},{default:o(()=>[t("div",ue,[t("p",ie,"￥"+k(l.value.actualPayment.toFixed(2))+"元",1),e(g,null,{default:o(()=>[e(c,{title:"微信支付",onClick:s[1]||(s[1]=r=>i.value=0)},{icon:o(()=>[e(w,{name:"consult-wechat"})]),extra:o(()=>[e(b,{checked:i.value===0},null,8,["checked"])]),_:1}),e(c,{title:"支付宝支付",onClick:s[2]||(s[2]=r=>i.value=1)},{icon:o(()=>[e(w,{name:"consult-alipay"})]),extra:o(()=>[e(b,{checked:i.value===1},null,8,["checked"])]),_:1})]),_:1}),t("div",pe,[e(B,{type:"primary",round:"",block:"",onClick:S},{default:o(()=>[x("立即支付")]),_:1})])])]),_:1},8,["show"])])}}});const be=Z(re,[["__scopeId","data-v-53e9aa0f"]]);export{be as default};
